#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
set -e

SERVER="root@37.27.193.227"
PROJECT_DIR="/opt/telegram-book-converter"

echo "üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤..."

# –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
echo "üìù –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
git add .
git commit -m "feat: –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫

- –î–æ–±–∞–≤–ª–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –¥–ª—è —Ñ–∞–π–ª–æ–≤ >20–ú–ë
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PDF —á–µ—Ä–µ–∑ Ghostscript
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 30 –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π"

# –ü—É—à–∏–º –Ω–∞ GitHub
echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub..."
git push origin main

# –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
ssh $SERVER "cd $PROJECT_DIR && git pull origin main"

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –Ω–æ–≤—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
echo "üèóÔ∏è –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Ghostscript..."
ssh $SERVER "cd $PROJECT_DIR && docker-compose down && docker-compose build --no-cache && docker-compose up -d"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
sleep 10
ssh $SERVER "cd $PROJECT_DIR && docker-compose logs --tail=20"

echo ""
echo "üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìã –ß—Ç–æ –Ω–æ–≤–æ–≥–æ:"
echo "‚Ä¢ üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PDF —Ñ–∞–π–ª–æ–≤"
echo "‚Ä¢ ‚è±Ô∏è –¢–∞–π–º–∞—É—Ç —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤"
echo "‚Ä¢ üìä –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ö–æ–¥–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"
echo "‚Ä¢ üÜî –°–∏—Å—Ç–µ–º–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"
echo "‚Ä¢ üí™ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 3500+ —Å—Ç—Ä–∞–Ω–∏—Ü"
echo ""
echo "üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
echo "‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–æ–ª—å—à–æ–π PDF —Ñ–∞–π–ª (>20–ú–ë)"
echo "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"
echo "‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—à–∏–±–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–¥—ã –∏ ID"
